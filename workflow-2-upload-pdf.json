{
  "name": "üìÑ Upload e Processamento de PDFs",
  "nodes": [
    {
      "parameters": {
        "formTitle": "Upload de Base de Conhecimento (PDF)",
        "formDescription": "Envie PDFs com legisla√ß√£o, jurisprud√™ncia ou informa√ß√µes previdenci√°rias. O agente ir√° consult√°-los automaticamente durante as conversas.",
        "formFields": {
          "values": [
            {
              "fieldLabel": "Nome do documento",
              "placeholder": "Ex: Tabela de Benef√≠cios INSS 2024",
              "fieldType": "text",
              "requiredField": true
            },
            {
              "fieldLabel": "Categoria",
              "fieldType": "dropdown",
              "fieldOptions": {
                "values": [
                  { "option": "Legisla√ß√£o" },
                  { "option": "Jurisprud√™ncia" },
                  { "option": "Tabelas e Valores" },
                  { "option": "Procedimentos INSS" },
                  { "option": "Outros" }
                ]
              },
              "requiredField": true
            },
            {
              "fieldLabel": "Arquivo PDF",
              "fieldType": "file",
              "acceptFileTypes": ".pdf",
              "requiredField": true
            }
          ]
        },
        "options": {}
      },
      "id": "node-form-pdf",
      "name": "Formul√°rio de Upload PDF",
      "type": "n8n-nodes-base.formTrigger",
      "typeVersion": 2.2,
      "position": [0, 300],
      "webhookId": "upload-pdf-sdr",
      "notes": "Acesse esta URL no navegador para fazer upload de PDFs para a base de conhecimento."
    },
    {
      "parameters": {
        "jsCode": "// Extrai metadados do formul√°rio\nconst form = $input.first().json;\nconst binaryData = $input.first().binary;\n\nreturn [{\n  json: {\n    nome: form['Nome do documento'],\n    categoria: form['Categoria'],\n    arquivo: 'Arquivo PDF',\n    uploadedAt: new Date().toISOString()\n  },\n  binary: binaryData\n}];"
      },
      "id": "node-extrai-metadados",
      "name": "Extrai metadados",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [220, 300]
    },
    {
      "parameters": {
        "operation": "pdf",
        "options": {}
      },
      "id": "node-extrai-texto-pdf",
      "name": "Extrai texto do PDF",
      "type": "n8n-nodes-base.extractFromFile",
      "typeVersion": 1,
      "position": [440, 300],
      "notes": "Converte o PDF em texto para processar."
    },
    {
      "parameters": {
        "chunkSize": 1000,
        "chunkOverlap": 200,
        "options": {}
      },
      "id": "node-divide-chunks",
      "name": "Divide em peda√ßos (chunks)",
      "type": "@n8n/n8n-nodes-langchain.textSplitterRecursiveCharacterTextSplitter",
      "typeVersion": 1,
      "position": [660, 300],
      "notes": "Divide o texto em blocos de 1000 caracteres com 200 de sobreposi√ß√£o para melhor busca."
    },
    {
      "parameters": {
        "model": "text-embedding-3-small",
        "options": {}
      },
      "id": "node-embeddings-openai",
      "name": "Gera embeddings (OpenAI)",
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1.2,
      "position": [880, 160],
      "notes": "Converte o texto em vetores num√©ricos para busca sem√¢ntica. Requer credencial OpenAI."
    },
    {
      "parameters": {
        "mode": "insert",
        "tableName": "documentos_conhecimento",
        "options": {
          "metadataColumns": [
            { "column": "nome_documento", "value": "={{ $('Extrai metadados').first().json.nome }}" },
            { "column": "categoria", "value": "={{ $('Extrai metadados').first().json.categoria }}" },
            { "column": "upload_em", "value": "={{ $('Extrai metadados').first().json.uploadedAt }}" }
          ]
        }
      },
      "id": "node-salva-vetores",
      "name": "Salva vetores no Supabase",
      "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
      "typeVersion": 1,
      "position": [880, 380],
      "notes": "Salva os chunks com embeddings na tabela documentos_conhecimento do Supabase."
    },
    {
      "parameters": {
        "respondWith": "text",
        "responseText": "‚úÖ PDF processado e adicionado √† base de conhecimento! O agente j√° pode consult√°-lo.",
        "options": {}
      },
      "id": "node-resposta-upload",
      "name": "Confirma upload",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [1100, 300]
    }
  ],
  "connections": {
    "Formul√°rio de Upload PDF": {
      "main": [[{ "node": "Extrai metadados", "type": "main", "index": 0 }]]
    },
    "Extrai metadados": {
      "main": [[{ "node": "Extrai texto do PDF", "type": "main", "index": 0 }]]
    },
    "Extrai texto do PDF": {
      "main": [[{ "node": "Divide em peda√ßos (chunks)", "type": "main", "index": 0 }]]
    },
    "Divide em peda√ßos (chunks)": {
      "main": [[{ "node": "Salva vetores no Supabase", "type": "main", "index": 0 }]]
    },
    "Gera embeddings (OpenAI)": {
      "ai_embedding": [[{ "node": "Salva vetores no Supabase", "type": "ai_embedding", "index": 0 }]]
    },
    "Salva vetores no Supabase": {
      "main": [[{ "node": "Confirma upload", "type": "main", "index": 0 }]]
    }
  },
  "settings": { "executionOrder": "v1" },
  "tags": ["pdf", "conhecimento", "rag", "sdr"],
  "meta": { "description": "Formul√°rio para upload de PDFs que ser√£o usados como base de conhecimento pelo agente.", "version": "1.0.0" }
}
